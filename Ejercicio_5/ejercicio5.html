<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validaci√≥n de Contrase√±a - Impacto en la Experiencia del Usuario</title>
    <link rel="stylesheet" href="ejercicio5styles.css">
</head>
<body>
    <div class="container">
        <div class="card">
            <h1 id="mainTitle">Cambio de Contrase√±a</h1>
            <p class="subtitle">Trabajo Pr√°ctico Integrador - EC VyV con UI</p>
            
            <div class="demo-section" id="demoSection">
                <h2 id="demoTitle">üîí Validaci√≥n de Contrase√±a con Car√°cter Especial</h2>
                <p class="description" id="demoDescription">
                    El sistema <strong>requiere al menos un car√°cter especial</strong> (!@#$%^&*) en la contrase√±a
                </p>
            </div>

            <form class="form" id="passwordForm">
                <div class="form-group">
                    <label for="currentPassword">Contrase√±a actual</label>
                    <input type="password" id="currentPassword" name="currentPassword" value="micontrase√±a123" readonly>
                </div>

                <div class="form-group">
                    <label for="newPassword">Nueva contrase√±a</label>
                    <div class="password-input-container">
                        <input type="password" id="newPassword" name="newPassword" placeholder="Ingrese su nueva contrase√±a" required>
                        <button type="button" class="toggle-password" id="toggleNewPassword">
                            <span class="eye-icon">üëÅÔ∏è</span>
                        </button>
                    </div>
                    <div class="help-text">Debe contener al menos un car√°cter especial (!@#$%^&*)</div>
                    <div class="validation-message" id="validationMessage"></div>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirmar nueva contrase√±a</label>
                    <div class="password-input-container">
                        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirme su nueva contrase√±a" required>
                        <button type="button" class="toggle-password" id="toggleConfirmPassword">
                            <span class="eye-icon">üëÅÔ∏è</span>
                        </button>
                    </div>
                    <div class="validation-message" id="confirmValidationMessage"></div>
                </div>

                <div class="password-requirements" id="passwordRequirements">
                    <h4>Requisitos de la contrase√±a:</h4>
                    <div class="requirement" id="lengthReq">
                        <span class="req-icon">‚ùå</span> Al menos 8 caracteres
                    </div>
                    <div class="requirement" id="upperReq">
                        <span class="req-icon">‚ùå</span> Al menos una letra may√∫scula
                    </div>
                    <div class="requirement" id="lowerReq">
                        <span class="req-icon">‚ùå</span> Al menos una letra min√∫scula
                    </div>
                    <div class="requirement" id="numberReq">
                        <span class="req-icon">‚ùå</span> Al menos un n√∫mero
                    </div>
                    <div class="requirement" id="specialReq">
                        <span class="req-icon">‚ùå</span> Al menos un car√°cter especial (!@#$%^&*)
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn" disabled>Cambiar Contrase√±a</button>
            </form>

            <div class="test-cases">
                <h3>üß™ Casos de Prueba</h3>
                <div class="test-grid">
                    <div class="test-case error" data-password="MiContrase√±a123">
                        <strong>‚ùå Sin car√°cter especial:</strong> MiContrase√±a123
                    </div>
                    <div class="test-case error" data-password="micontrase√±a123">
                        <strong>‚ùå Sin may√∫scula ni especial:</strong> micontrase√±a123
                    </div>
                    <div class="test-case valid" data-password="MiContrase√±a123!">
                        <strong>‚úÖ V√°lida:</strong> MiContrase√±a123!
                    </div>
                    <div class="test-case valid" data-password="Segura2024@">
                        <strong>‚úÖ V√°lida:</strong> Segura2024@
                    </div>
                </div>
                <p class="error-explanation">
                    <strong>¬°Problema de UX!</strong> Los usuarios frecuentemente olvidan incluir caracteres especiales, lo que genera frustraci√≥n al ser rechazadas contrase√±as que consideran "seguras".
                </p>
            </div>

            <div class="error-message" id="errorMessage" style="display: none;">
                <div class="error-content">
                    <span class="error-icon">‚ùå</span>
                    <div>
                        <strong>Error de validaci√≥n</strong>
                        <p id="errorText"></p>
                    </div>
                </div>
            </div>

            <div class="success-message" id="successMessage" style="display: none;">
                <div class="success-content">
                    <span class="success-icon">üéâ</span>
                    <div>
                        <strong>¬°Contrase√±a cambiada exitosamente!</strong>
                        <p id="successText"></p>
                    </div>
                </div>
            </div>
            
            <div class="final-success-banner" id="finalSuccessBanner" style="display: none;">
                <div class="banner-content">
                    <span class="banner-icon">üîê</span>
                    <div>
                        <strong>¬°Contrase√±a actualizada!</strong>
                        <p>Su contrase√±a ha sido cambiada exitosamente.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('passwordForm');
        const newPasswordInput = document.getElementById('newPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const validationMessage = document.getElementById('validationMessage');
        const confirmValidationMessage = document.getElementById('confirmValidationMessage');
        const submitBtn = document.getElementById('submitBtn');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');

        // Referencias a los requisitos
        const lengthReq = document.getElementById('lengthReq');
        const upperReq = document.getElementById('upperReq');
        const lowerReq = document.getElementById('lowerReq');
        const numberReq = document.getElementById('numberReq');
        const specialReq = document.getElementById('specialReq');

        // Funci√≥n para validar contrase√±a
        function validatePassword(password) {
            const requirements = {
                length: password.length >= 8,
                upper: /[A-Z]/.test(password),
                lower: /[a-z]/.test(password),
                number: /\d/.test(password),
                special: /[!@#$%^&*]/.test(password)
            };
            
            return requirements;
        }

        // Funci√≥n para actualizar los requisitos visuales
        function updateRequirements(requirements) {
            updateRequirement(lengthReq, requirements.length);
            updateRequirement(upperReq, requirements.upper);
            updateRequirement(lowerReq, requirements.lower);
            updateRequirement(numberReq, requirements.number);
            updateRequirement(specialReq, requirements.special);
        }

        function updateRequirement(element, isValid) {
            const icon = element.querySelector('.req-icon');
            if (isValid) {
                icon.textContent = '‚úÖ';
                element.classList.add('valid');
                element.classList.remove('invalid');
            } else {
                icon.textContent = '‚ùå';
                element.classList.add('invalid');
                element.classList.remove('valid');
            }
        }

        // Funci√≥n para actualizar el contenido de la p√°gina seg√∫n el estado
        function updatePageContent(hasSpecialChar, isValidPassword) {
            const mainTitle = document.getElementById('mainTitle');
            const demoTitle = document.getElementById('demoTitle');
            const demoDescription = document.getElementById('demoDescription');
            const demoSection = document.getElementById('demoSection');
            
            if (isValidPassword) {
                // Contrase√±a completamente v√°lida
                mainTitle.innerHTML = 'Cambio de Contrase√±a - <span style="color: #8b47ee;">V√°lida</span>';
                demoTitle.innerHTML = '‚úÖ Contrase√±a V√°lida';
                demoDescription.innerHTML = 'La contrase√±a cumple con <strong>todos los requisitos</strong> incluyendo el car√°cter especial';
                demoSection.style.background = 'linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1))';
                demoSection.style.borderColor = 'rgb(34, 197, 94)';
            } else if (!hasSpecialChar) {
                // Falta car√°cter especial - Error principal
                mainTitle.innerHTML = 'Cambio de Contrase√±a - <span style="color: #8b47ee;">Error de Validaci√≥n</span>';
                demoTitle.innerHTML = '‚ùå Falta Car√°cter Especial';
                demoDescription.innerHTML = 'La contrase√±a <strong>NO contiene caracteres especiales</strong> requeridos (!@#$%^&*)';
                demoSection.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1))';
                demoSection.style.borderColor = 'rgb(239, 68, 68)';
            } else {
                // Otros errores de validaci√≥n
                mainTitle.innerHTML = 'Cambio de Contrase√±a - <span style="color: #8b47ee;">Validaci√≥n Parcial</span>';
                demoTitle.innerHTML = '‚ö†Ô∏è Requisitos Faltantes';
                demoDescription.innerHTML = 'La contrase√±a tiene car√°cter especial pero <strong>faltan otros requisitos</strong>';
                demoSection.style.background = 'linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(234, 179, 8, 0.1))';
                demoSection.style.borderColor = 'rgb(234, 179, 8)';
            }
        }

        // Validaci√≥n en tiempo real de la nueva contrase√±a
        newPasswordInput.addEventListener('input', function() {
            const password = this.value;
            const requirements = validatePassword(password);
            
            updateRequirements(requirements);
            
            const allValid = Object.values(requirements).every(req => req);
            const hasSpecialChar = requirements.special;
            
            updatePageContent(hasSpecialChar, allValid);
            
            if (password === '') {
                validationMessage.textContent = '';
                validationMessage.className = 'validation-message';
                this.style.borderColor = '#404040';
                this.style.boxShadow = 'none';
            } else if (!hasSpecialChar) {
                validationMessage.textContent = '‚ùå Falta car√°cter especial (!@#$%^&*)';
                validationMessage.className = 'validation-message error';
                this.style.borderColor = 'rgb(239, 68, 68)';
                this.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.2)';
            } else if (!allValid) {
                validationMessage.textContent = '‚ö†Ô∏è Faltan algunos requisitos';
                validationMessage.className = 'validation-message warning';
                this.style.borderColor = '#eab308';
                this.style.boxShadow = '0 0 0 3px rgba(234, 179, 8, 0.2)';
            } else {
                validationMessage.textContent = '‚úÖ Contrase√±a v√°lida';
                validationMessage.className = 'validation-message success';
                this.style.borderColor = '#00e6e6';
                this.style.boxShadow = '0 0 0 3px rgba(0, 230, 230, 0.2)';
            }
            
            checkFormValidity();
        });

        // Validaci√≥n de confirmaci√≥n de contrase√±a
        confirmPasswordInput.addEventListener('input', function() {
            const newPassword = newPasswordInput.value;
            const confirmPassword = this.value;
            
            if (confirmPassword === '') {
                confirmValidationMessage.textContent = '';
                confirmValidationMessage.className = 'validation-message';
                this.style.borderColor = '#404040';
                this.style.boxShadow = 'none';
            } else if (newPassword !== confirmPassword) {
                confirmValidationMessage.textContent = '‚ùå Las contrase√±as no coinciden';
                confirmValidationMessage.className = 'validation-message error';
                this.style.borderColor = 'rgb(239, 68, 68)';
                this.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.2)';
            } else {
                confirmValidationMessage.textContent = '‚úÖ Las contrase√±as coinciden';
                confirmValidationMessage.className = 'validation-message success';
                this.style.borderColor = '#00e6e6';
                this.style.boxShadow = '0 0 0 3px rgba(0, 230, 230, 0.2)';
            }
            
            checkFormValidity();
        });

        // Funci√≥n para verificar si el formulario es v√°lido
        function checkFormValidity() {
            const newPassword = newPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            const requirements = validatePassword(newPassword);
            const allValid = Object.values(requirements).every(req => req);
            const passwordsMatch = newPassword === confirmPassword && confirmPassword !== '';
            
            if (allValid && passwordsMatch) {
                submitBtn.disabled = false;
                submitBtn.style.opacity = '1';
                submitBtn.style.cursor = 'pointer';
            } else {
                submitBtn.disabled = true;
                submitBtn.style.opacity = '0.6';
                submitBtn.style.cursor = 'not-allowed';
            }
        }

        // Manejo del env√≠o del formulario
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newPassword = newPasswordInput.value;
            const requirements = validatePassword(newPassword);
            const allValid = Object.values(requirements).every(req => req);
            
            if (!allValid) {
                const missingReqs = [];
                if (!requirements.length) missingReqs.push('al menos 8 caracteres');
                if (!requirements.upper) missingReqs.push('una letra may√∫scula');
                if (!requirements.lower) missingReqs.push('una letra min√∫scula');
                if (!requirements.number) missingReqs.push('un n√∫mero');
                if (!requirements.special) missingReqs.push('un car√°cter especial');
                
                document.getElementById('errorText').textContent = 
                    `La contrase√±a debe contener: ${missingReqs.join(', ')}.`;
                errorMessage.style.display = 'block';
                
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 5000);
                
                return;
            }
            
            // Simular √©xito
            document.getElementById('successText').textContent = 
                'Su contrase√±a cumple con todos los requisitos de seguridad.';
            successMessage.style.display = 'block';
            
            setTimeout(() => {
                successMessage.style.display = 'none';
                
                const finalBanner = document.getElementById('finalSuccessBanner');
                finalBanner.style.display = 'block';
                
                setTimeout(() => {
                    finalBanner.style.display = 'none';
                    form.reset();
                    validationMessage.textContent = '';
                    confirmValidationMessage.textContent = '';
                    validationMessage.className = 'validation-message';
                    confirmValidationMessage.className = 'validation-message';
                    newPasswordInput.style.borderColor = '#404040';
                    newPasswordInput.style.boxShadow = 'none';
                    confirmPasswordInput.style.borderColor = '#404040';
                    confirmPasswordInput.style.boxShadow = 'none';
                    
                    // Resetear requisitos
                    document.querySelectorAll('.requirement').forEach(req => {
                        req.classList.remove('valid', 'invalid');
                        req.querySelector('.req-icon').textContent = '‚ùå';
                    });
                    
                    updatePageContent(false, false);
                    checkFormValidity();
                }, 5000);
            }, 2000);
        });

        // Funcionalidad para mostrar/ocultar contrase√±as
        function togglePasswordVisibility(inputId, buttonId) {
            const input = document.getElementById(inputId);
            const button = document.getElementById(buttonId);
            const eyeIcon = button.querySelector('.eye-icon');
            
            if (input.type === 'password') {
                input.type = 'text';
                eyeIcon.textContent = 'üôà';
                button.setAttribute('aria-label', 'Ocultar contrase√±a');
                button.title = 'Ocultar contrase√±a';
            } else {
                input.type = 'password';
                eyeIcon.textContent = 'üëÅÔ∏è';
                button.setAttribute('aria-label', 'Mostrar contrase√±a');
                button.title = 'Mostrar contrase√±a';
            }
        }

        // Eventos para los botones de mostrar/ocultar contrase√±a
        document.getElementById('toggleNewPassword').addEventListener('click', function() {
            togglePasswordVisibility('newPassword', 'toggleNewPassword');
        });

        document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
            togglePasswordVisibility('confirmPassword', 'toggleConfirmPassword');
        });

        // Agregar eventos a los casos de prueba
        document.querySelectorAll('.test-case').forEach(testCase => {
            testCase.addEventListener('click', function() {
                const password = this.getAttribute('data-password');
                newPasswordInput.value = password;
                confirmPasswordInput.value = password;
                
                newPasswordInput.dispatchEvent(new Event('input'));
                confirmPasswordInput.dispatchEvent(new Event('input'));
            });
        });

        // Inicializar con un caso de error para mostrar el problema
        setTimeout(() => {
            newPasswordInput.value = 'MiContrase√±a123';
            newPasswordInput.dispatchEvent(new Event('input'));
        }, 500);
    </script>
</body>
</html>